"use strict";var U=Object.create;var v=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var J=(t,e)=>{for(var r in e)v(t,r,{get:e[r],enumerable:!0})},R=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of H(e))!Y.call(t,n)&&n!==r&&v(t,n,{get:()=>e[n],enumerable:!(o=j(e,n))||o.enumerable});return t};var d=(t,e,r)=>(r=t!=null?U(X(t)):{},R(e||!t||!t.__esModule?v(r,"default",{value:t,enumerable:!0}):r,t)),V=t=>R(v({},"__esModule",{value:!0}),t);var ce={};J(ce,{activate:()=>ae,deactivate:()=>le});module.exports=V(ce);var m=d(require("vscode"));var S=d(require("fs")),x=null;function z(){switch(process.platform){case"darwin":return"macos";case"win32":return"windows";default:return"linux"}}function K(){try{let t=S.readFileSync("/proc/version","utf-8");return/microsoft/i.test(t)}catch{return!1}}function Q(t,e){if(t!=="linux"||e)return"unknown";let r=process.env.XDG_SESSION_TYPE;return r==="wayland"?"wayland":r==="x11"?"x11":"unknown"}function Z(t,e){if(t==="windows")return"powershell.exe";if(e){let r=["/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe","/mnt/c/Program Files/PowerShell/7/pwsh.exe"];for(let o of r)if(S.existsSync(o))return o;return"powershell.exe"}return null}function W(){if(x)return x;let t=z(),e=t==="linux"?K():!1,r=Q(t,e),o=Z(t,e);return x={os:t,isWSL:e,displayServer:r,powershellPath:o},x}var T=require("child_process"),N=1e4,ee=10*1024*1024,te=50*1024*1024;function k(t){return"code"in t&&typeof t.code=="number"?t.code:t.code??"unknown"}function l(t,e,r){return new Promise((o,n)=>{(0,T.execFile)(t,e,{encoding:"utf-8",timeout:r?.timeout??N,maxBuffer:r?.maxBuffer??ee,cwd:r?.cwd},(a,s,i)=>{if(a){n(new Error(`Command "${t}" failed (exit code ${k(a)}): ${i||a.message}`));return}o({stdout:s,stderr:i})})})}function g(t,e,r){return new Promise((o,n)=>{(0,T.execFile)(t,e,{encoding:"buffer",timeout:r?.timeout??N,maxBuffer:r?.maxBuffer??te,cwd:r?.cwd},(a,s,i)=>{let P=i instanceof Buffer?i.toString("utf-8"):String(i);if(a){n(new Error(`Command "${t}" failed (exit code ${k(a)}): ${P||a.message}`));return}o({stdout:s,stderr:P})})})}var y=class{requiredTool(){return"pngpaste"}async isToolAvailable(){try{return await l("which",["pngpaste"]),!0}catch{return!1}}async hasImage(){try{let{stdout:e}=await l("osascript",["-e","clipboard info"]);return e.includes("\xABclass PNGf\xBB")||e.includes("\xABclass TIFF\xBB")}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");let{stdout:r}=await g("pngpaste",["-"]);return r}};var I=class{displayServer;constructor(e){this.displayServer=e}isWayland(){return this.displayServer==="wayland"}requiredTool(){return this.isWayland()?"wl-clipboard (wl-paste)":"xclip"}async isToolAvailable(){try{return this.isWayland()?await l("which",["wl-paste"]):await l("which",["xclip"]),!0}catch{return!1}}async hasImage(){try{if(this.isWayland()){let{stdout:e}=await l("wl-paste",["--list-types"]);return e.includes("image/png")}else{let{stdout:e}=await l("xclip",["-selection","clipboard","-t","TARGETS","-o"]);return e.includes("image/png")}}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");if(this.isWayland()){let{stdout:r}=await g("wl-paste",["--type","image/png"]);return r}else{let{stdout:r}=await g("xclip",["-selection","clipboard","-t","image/png","-o"]);return r}}};var $=d(require("fs"));var re="Add-Type -AssemblyName System.Windows.Forms; if ([System.Windows.Forms.Clipboard]::ContainsImage()) { echo 'yes' } else { echo 'no' }",oe="Add-Type -AssemblyName System.Windows.Forms; $img = [System.Windows.Forms.Clipboard]::GetImage(); if ($img -eq $null) { exit 1 }; $tmp = [System.IO.Path]::GetTempFileName(); $img.Save($tmp, [System.Drawing.Imaging.ImageFormat]::Png); Write-Output $tmp",p=class{async isToolAvailable(){try{return await l(this.powershellExe,["-Command","echo ok"]),!0}catch{return!1}}async hasImage(){try{return(await l(this.powershellExe,["-Command",re])).stdout.trim()==="yes"}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");let r=await l(this.powershellExe,["-Command",oe]),o=await this.resolveTempPath(r.stdout.trim());try{return await $.promises.readFile(o)}finally{$.promises.unlink(o).catch(()=>{})}}};var b=class extends p{get powershellExe(){return"powershell.exe"}requiredTool(){return"PowerShell (built-in)"}async resolveTempPath(e){return e}};var E=class extends p{psPath;constructor(e){super(),this.psPath=e.powershellPath??"powershell.exe"}get powershellExe(){return this.psPath}requiredTool(){return"PowerShell (via WSL interop)"}async resolveTempPath(e){return(await l("wslpath",["-u",e])).stdout.trim()}};function B(t){if(t.isWSL)return new E(t);switch(t.os){case"macos":return new y;case"windows":return new b;case"linux":return new I(t.displayServer)}}var f=d(require("fs")),u=d(require("path")),w=d(require("vscode"));var M=d(require("vscode"));function C(){let t=new Date,e=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0"),n=String(t.getMilliseconds()).padStart(3,"0");return`[${e}:${r}:${o}.${n}]`}function ne(t){let e=M.window.createOutputChannel(t);return{info(r){e.appendLine(`${C()} [INFO] ${r}`)},warn(r){e.appendLine(`${C()} [WARN] ${r}`)},error(r,o){let n=`${C()} [ERROR] ${r}`;o!==void 0&&(o instanceof Error&&o.stack?n+=`
${o.stack}`:n+=`
${String(o)}`),e.appendLine(n)},show(){e.show()}}}var c=ne("Terminal Image Paste");var se=".tip-images";function F(){return w.workspace.getConfiguration("terminalImgPaste")}function D(){let t=w.workspace.workspaceFolders;if(!t||t.length===0)throw w.window.showErrorMessage("Terminal Image Paste: No workspace folder is open. Please open a folder first."),new Error("No workspace folder is open");return t[0].uri.fsPath}function _(){return F().get("folderName",se)}function L(){return u.join(D(),_())}function ie(){let t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0"),i=String(t.getMilliseconds()).padStart(3,"0");return`img-${e}-${r}-${o}T${n}-${a}-${s}-${i}.png`}function O(){return{async save(t){let e=L();await f.promises.mkdir(e,{recursive:!0});let r=ie(),o=u.join(e,r);return await f.promises.writeFile(o,t),c.info(`Saved image: ${o}`),await this.cleanup(),await this.ensureGitIgnored(),o},async cleanup(){let e=F().get("maxImages",20);if(e<=0)return;let r=L(),o;try{o=await f.promises.readdir(r)}catch{return}let n=o.filter(s=>s.endsWith(".png")).sort();if(n.length<=e)return;let a=n.slice(0,n.length-e);for(let s of a){let i=u.join(r,s);await f.promises.unlink(i),c.info(`Deleted old image: ${i}`)}},async ensureGitIgnored(){if(!F().get("autoGitIgnore",!0))return;let e=_(),r=D(),o=u.join(r,".gitignore"),n;try{n=await f.promises.readFile(o,"utf-8")}catch{await f.promises.writeFile(o,e+`
`,"utf-8"),c.info(`Created .gitignore with ${e}`);return}if(n.split(`
`).map(i=>i.trim()).includes(e))return;let s=n.endsWith(`
`)?"":`
`;await f.promises.writeFile(o,n+s+e+`
`,"utf-8"),c.info(`Added ${e} to .gitignore`)}}}var h=d(require("vscode"));function A(t){let e=h.window.activeTerminal;if(!e){h.window.showErrorMessage("Terminal Image Paste: No active terminal. Please open a terminal first.");return}let r="'"+t.replace(/'/g,"'\\''")+"'",n=h.workspace.getConfiguration("terminalImgPaste").get("sendNewline",!1);e.sendText(r,n),c.info(`Inserted path into terminal: ${r}`)}function G(t,e){let r=e instanceof Error?e.message:String(e);m.window.showErrorMessage(`Terminal Image Paste: ${r}`),c.error(`${t} command failed`,e)}function ae(t){let e=W(),r=B(e),o=O();r.isToolAvailable().then(s=>{s||m.window.showWarningMessage(`Terminal Image Paste: clipboard tool "${r.requiredTool()}" not found. Install it to use clipboard image pasting.`)}).catch(s=>{c.error("Failed to check tool availability",s)});let n=m.commands.registerCommand("terminalImgPaste.pasteImage",async()=>{try{if(!await r.isToolAvailable()){m.window.showWarningMessage(`Terminal Image Paste: "${r.requiredTool()}" is not installed. Please install it to paste clipboard images.`);return}if(!await r.hasImage()){m.window.showInformationMessage("No image found in clipboard.");return}let P=await r.readImage(),q=await o.save(P);A(q),m.window.setStatusBarMessage("Image pasted to terminal",3e3)}catch(s){G("pasteImage",s)}}),a=m.commands.registerCommand("terminalImgPaste.sendPathToTerminal",async s=>{try{if(!s?.fsPath){m.window.showErrorMessage("Terminal Image Paste: No file selected.");return}A(s.fsPath),m.window.setStatusBarMessage("Path sent to terminal",3e3)}catch(i){G("sendPathToTerminal",i)}});t.subscriptions.push(n,a),c.info(`Extension activated (platform: ${e.os}, WSL: ${e.isWSL})`)}function le(){c.info("Extension deactivating")}0&&(module.exports={activate,deactivate});
//# sourceMappingURL=extension.js.map
