"use strict";var j=Object.create;var v=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var V=(e,t)=>{for(var r in t)v(e,r,{get:t[r],enumerable:!0})},W=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of H(t))!J.call(e,n)&&n!==r&&v(e,n,{get:()=>t[n],enumerable:!(o=U(t,n))||o.enumerable});return e};var d=(e,t,r)=>(r=e!=null?j(Y(e)):{},W(t||!e||!e.__esModule?v(r,"default",{value:e,enumerable:!0}):r,e)),X=e=>W(v({},"__esModule",{value:!0}),e);var ae={};V(ae,{activate:()=>se,deactivate:()=>ie});module.exports=X(ae);var m=d(require("vscode"));var x=d(require("fs")),S=null;function z(){switch(process.platform){case"darwin":return"macos";case"win32":return"windows";default:return"linux"}}function K(){try{let e=x.readFileSync("/proc/version","utf-8");return/microsoft/i.test(e)}catch{return!1}}function Q(e,t){if(e!=="linux"||t)return"unknown";let r=process.env.XDG_SESSION_TYPE;return r==="wayland"?"wayland":r==="x11"?"x11":"unknown"}function Z(e,t){if(e==="windows")return"powershell.exe";if(t){let r=["/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe","/mnt/c/Program Files/PowerShell/7/pwsh.exe"];for(let o of r)if(x.existsSync(o))return o;return"powershell.exe"}return null}function A(){if(S)return S;let e=z(),t=e==="linux"?K():!1,r=Q(e,t),o=Z(e,t);return S={os:e,isWSL:t,displayServer:r,powershellPath:o},S}var $=require("child_process"),N=1e4;function k(e){return"code"in e&&typeof e.code=="number"?e.code:e.code??"unknown"}function l(e,t,r){return new Promise((o,n)=>{(0,$.execFile)(e,t,{encoding:"utf-8",timeout:r?.timeout??N,cwd:r?.cwd},(a,s,i)=>{if(a){n(new Error(`Command "${e}" failed (exit code ${k(a)}): ${i||a.message}`));return}o({stdout:s,stderr:i})})})}function p(e,t,r){return new Promise((o,n)=>{(0,$.execFile)(e,t,{encoding:"buffer",timeout:r?.timeout??N,cwd:r?.cwd},(a,s,i)=>{let P=i instanceof Buffer?i.toString("utf-8"):String(i);if(a){n(new Error(`Command "${e}" failed (exit code ${k(a)}): ${P||a.message}`));return}o({stdout:s,stderr:P})})})}var y=class{requiredTool(){return"pngpaste"}async isToolAvailable(){try{return await l("which",["pngpaste"]),!0}catch{return!1}}async hasImage(){try{let{stdout:t}=await l("osascript",["-e","clipboard info"]);return t.includes("\xABclass PNGf\xBB")||t.includes("\xABclass TIFF\xBB")}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");let{stdout:r}=await p("pngpaste",["-"]);return r}};var b=class{displayServer;constructor(t){this.displayServer=t}isWayland(){return this.displayServer==="wayland"}requiredTool(){return this.isWayland()?"wl-clipboard (wl-paste)":"xclip"}async isToolAvailable(){try{return this.isWayland()?await l("which",["wl-paste"]):await l("which",["xclip"]),!0}catch{return!1}}async hasImage(){try{if(this.isWayland()){let{stdout:t}=await l("wl-paste",["--list-types"]);return t.includes("image/png")}else{let{stdout:t}=await l("xclip",["-selection","clipboard","-t","TARGETS","-o"]);return t.includes("image/png")}}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");if(this.isWayland()){let{stdout:r}=await p("wl-paste",["--type","image/png"]);return r}else{let{stdout:r}=await p("xclip",["-selection","clipboard","-t","image/png","-o"]);return r}}};var E=d(require("fs"));var ee="Add-Type -AssemblyName System.Windows.Forms; if ([System.Windows.Forms.Clipboard]::ContainsImage()) { echo 'yes' } else { echo 'no' }",te="Add-Type -AssemblyName System.Windows.Forms; $img = [System.Windows.Forms.Clipboard]::GetImage(); if ($img -eq $null) { exit 1 }; $tmp = [System.IO.Path]::GetTempFileName(); $img.Save($tmp, [System.Drawing.Imaging.ImageFormat]::Png); Write-Output $tmp",g=class{async isToolAvailable(){try{return await l(this.powershellExe,["-Command","echo ok"]),!0}catch{return!1}}async hasImage(){try{return(await l(this.powershellExe,["-Command",ee])).stdout.trim()==="yes"}catch{return!1}}async readImage(){if(!await this.hasImage())throw new Error("No image found in clipboard");let r=await l(this.powershellExe,["-Command",te]),o=await this.resolveTempPath(r.stdout.trim());try{return await E.promises.readFile(o)}finally{E.promises.unlink(o).catch(()=>{})}}};var I=class extends g{get powershellExe(){return"powershell.exe"}requiredTool(){return"PowerShell (built-in)"}async resolveTempPath(t){return t}};var T=class extends g{psPath;constructor(t){super(),this.psPath=t.powershellPath??"powershell.exe"}get powershellExe(){return this.psPath}requiredTool(){return"PowerShell (via WSL interop)"}async resolveTempPath(t){return(await l("wslpath",["-u",t])).stdout.trim()}};function M(e){if(e.isWSL)return new T(e);switch(e.os){case"macos":return new y;case"windows":return new I;case"linux":return new b(e.displayServer)}}var f=d(require("fs")),u=d(require("path")),w=d(require("vscode"));var L=d(require("vscode"));function C(){let e=new Date,t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0"),n=String(e.getMilliseconds()).padStart(3,"0");return`[${t}:${r}:${o}.${n}]`}function re(e){let t=L.window.createOutputChannel(e);return{info(r){t.appendLine(`${C()} [INFO] ${r}`)},warn(r){t.appendLine(`${C()} [WARN] ${r}`)},error(r,o){let n=`${C()} [ERROR] ${r}`;o!==void 0&&(o instanceof Error&&o.stack?n+=`
${o.stack}`:n+=`
${String(o)}`),t.appendLine(n)},show(){t.show()}}}var c=re("Terminal Image Paste");var oe=".tip-images";function F(){return w.workspace.getConfiguration("terminalImgPaste")}function D(){let e=w.workspace.workspaceFolders;if(!e||e.length===0)throw w.window.showErrorMessage("Terminal Image Paste: No workspace folder is open. Please open a folder first."),new Error("No workspace folder is open");return e[0].uri.fsPath}function G(){return F().get("folderName",oe)}function B(){return u.join(D(),G())}function ne(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0"),i=String(e.getMilliseconds()).padStart(3,"0");return`img-${t}-${r}-${o}T${n}-${a}-${s}-${i}.png`}function _(){return{async save(e){let t=B();await f.promises.mkdir(t,{recursive:!0});let r=ne(),o=u.join(t,r);return await f.promises.writeFile(o,e),c.info(`Saved image: ${o}`),await this.cleanup(),await this.ensureGitIgnored(),o},async cleanup(){let t=F().get("maxImages",20);if(t<=0)return;let r=B(),o;try{o=await f.promises.readdir(r)}catch{return}let n=o.filter(s=>s.endsWith(".png")).sort();if(n.length<=t)return;let a=n.slice(0,n.length-t);for(let s of a){let i=u.join(r,s);await f.promises.unlink(i),c.info(`Deleted old image: ${i}`)}},async ensureGitIgnored(){if(!F().get("autoGitIgnore",!0))return;let t=G(),r=D(),o=u.join(r,".gitignore"),n;try{n=await f.promises.readFile(o,"utf-8")}catch{await f.promises.writeFile(o,t+`
`,"utf-8"),c.info(`Created .gitignore with ${t}`);return}if(n.split(`
`).map(i=>i.trim()).includes(t))return;let s=n.endsWith(`
`)?"":`
`;await f.promises.writeFile(o,n+s+t+`
`,"utf-8"),c.info(`Added ${t} to .gitignore`)}}}var h=d(require("vscode"));function R(e){let t=h.window.activeTerminal;if(!t){h.window.showErrorMessage("Terminal Image Paste: No active terminal. Please open a terminal first.");return}let r=e.includes(" ")?`"${e}"`:e,n=h.workspace.getConfiguration("terminalImgPaste").get("sendNewline",!1);t.sendText(r,n),c.info(`Inserted path into terminal: ${r}`)}function O(e,t){let r=t instanceof Error?t.message:String(t);m.window.showErrorMessage(`Terminal Image Paste: ${r}`),c.error(`${e} command failed`,t)}function se(e){let t=A(),r=M(t),o=_();r.isToolAvailable().then(s=>{s||m.window.showWarningMessage(`Terminal Image Paste: clipboard tool "${r.requiredTool()}" not found. Install it to use clipboard image pasting.`)}).catch(s=>{c.error("Failed to check tool availability",s)});let n=m.commands.registerCommand("terminalImgPaste.pasteImage",async()=>{try{if(!await r.isToolAvailable()){m.window.showWarningMessage(`Terminal Image Paste: "${r.requiredTool()}" is not installed. Please install it to paste clipboard images.`);return}if(!await r.hasImage()){m.window.showInformationMessage("No image found in clipboard.");return}let P=await r.readImage(),q=await o.save(P);R(q),m.window.setStatusBarMessage("Image pasted to terminal",3e3)}catch(s){O("pasteImage",s)}}),a=m.commands.registerCommand("terminalImgPaste.sendPathToTerminal",async s=>{try{if(!s?.fsPath){m.window.showErrorMessage("Terminal Image Paste: No file selected.");return}R(s.fsPath),m.window.setStatusBarMessage("Path sent to terminal",3e3)}catch(i){O("sendPathToTerminal",i)}});e.subscriptions.push(n,a),c.info(`Extension activated (platform: ${t.os}, WSL: ${t.isWSL})`)}function ie(){c.info("Extension deactivating")}0&&(module.exports={activate,deactivate});
//# sourceMappingURL=extension.js.map
